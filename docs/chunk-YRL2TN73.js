import{b as Q,c as X,d as Z}from"./chunk-RYS62C2J.js";import{a as E}from"./chunk-D6THCZXM.js";import{a as J}from"./chunk-VIEIPB32.js";import{a as K}from"./chunk-7UI3GJNS.js";import{b as q}from"./chunk-EEMBQGBN.js";import{c as j}from"./chunk-TWKM367Z.js";import{a as G}from"./chunk-A45XJCY7.js";import{D as W,G as x,L as V,ka as L,ma as z,na as B}from"./chunk-D5KMJPJG.js";import{Ab as C,Gc as A,Oa as n,Pb as h,Qb as D,Qc as $,Tb as w,Ub as T,Vb as y,_a as O,a as S,b as v,db as _,f,fd as Y,ja as m,jd as P,l as H,pc as k,rb as o,sb as d,tb as c,wd as U,xd as N}from"./chunk-C35VUVUC.js";function ie(l,e){if(l&1&&(d(0,"mat-option",6),h(1),c()),l&2){let a=e.$implicit;o("value",a.id),n(),D(a.name)}}function se(l,e){if(l&1&&(d(0,"mat-option",6),h(1),c()),l&2){let a=e.$implicit;o("value",a.id),n(),D(a.name)}}var ee=class l{viewDate=new Date;dayIndex=this.viewDate.getDay();TIME_PERIOD=6;DAY_START_HOUR=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth(),this.viewDate.getDate(),8,0);DAY_END_HOUR=new Date(this.viewDate.getFullYear(),this.viewDate.getMonth(),this.viewDate.getDate(),20,0);selectedStart=null;dialog=m(j);courseService=m(J);teacherService=m(K);classService=m(q);events=[];allEvents=[];modalFormConfig={title:"Ders Ekle",fields:[{key:"courseId",label:"Ders",type:"select",options:this.courseService.courses().map(e=>({value:e.id,label:e.name}))},{key:"teacherId",label:"\xD6\u011Fretmen",type:"select",options:this.teacherService.teachers().map(e=>({value:e.id,label:`${e.name} ${e.surname}`}))},{key:"start",label:"Ba\u015Flang\u0131\xE7",type:"time",timeOptions:{min:`${this.DAY_START_HOUR.getHours()}:${this.DAY_START_HOUR.getMinutes()}`,max:`${this.DAY_END_HOUR.getHours()}:${this.DAY_END_HOUR.getMinutes()}`,interval:`${60/this.TIME_PERIOD}min`}},{key:"end",label:"Biti\u015F",type:"time",timeOptions:{min:`${this.DAY_START_HOUR.getHours()}:${this.DAY_START_HOUR.getMinutes()}`,max:`${this.DAY_END_HOUR.getHours()}:${this.DAY_END_HOUR.getMinutes()}`,interval:`${60/this.TIME_PERIOD}min`}},{key:"description",label:"A\xE7\u0131klama",type:"textarea"}]};refresh=new H;listClass=[];listTeacher=[];selectedClassId=null;selectedTeacherId=null;constructor(){this.listClass=this.classService.classes().map(e=>({id:e.id,name:e.name})),this.selectedClassId=this.classService.selectedClass()?.id||null,this.selectedTeacherId=this.teacherService.selectedTeacher()?.id||null,this.listTeacher=this.teacherService.teachers().map(e=>({id:e.id,name:`${e.name} ${e.surname}`})),this.classService.getClasSchedule(this.classService.selectedClass()?.id||""),k(()=>{this.prepareAllEvents(),this.updateEvents()})}prepareAllEvents(){let e=new Date(this.viewDate),a=e.getDay(),t=(a===0?-6:1)-a;e.setDate(e.getDate()+t),e.setHours(0,0,0,0),this.allEvents=this.classService.classSchedule().map(i=>{let s=i.start.getDay(),r=new Date(e),g=s===0?6:s-1;r.setDate(e.getDate()+g),r.setHours(i.start.getHours(),i.start.getMinutes(),0,0);let u=new Date(r);return u.setHours(i.end.getHours(),i.end.getMinutes(),0,0),v(S({},i),{title:this.getEventTitle(i),color:{primary:"var(--calendar-primary)",secondary:"var(--calendar-secondary)"},draggable:!0,resizable:{beforeStart:!0,afterEnd:!0},start:r,end:u,meta:{id:i.id,teacherId:i.teacherId,classId:i.classId,description:i.description}})})}updateEvents(){let e=this.allEvents;this.selectedClassId&&(e=e.filter(a=>a.meta.classId===this.selectedClassId)),this.selectedTeacherId&&(e=e.filter(a=>a.meta.teacherId===this.selectedTeacherId)),this.events=e,this.refresh.next()}courseScheduleTimesChanged(i){return f(this,arguments,function*({event:e,newStart:a,newEnd:t}){yield this.classService.updateCourseScheduleCourse(e.meta.id,{start:a,end:t}),this.refresh.next()})}updateCourseSchedule(e){this.modalFormConfig.title="Ders D\xFCzenle",this.modalFormConfig.fields[0].value=e.meta.courseId,this.modalFormConfig.fields[1].value=e.meta.teacherId,this.modalFormConfig.fields[2].value=e.start,this.modalFormConfig.fields[3].value=e.end,this.modalFormConfig.fields[4].value=e.meta.description,this.dialog.open(E,{data:{config:this.modalFormConfig}}).afterClosed().subscribe(t=>f(this,null,function*(){t&&(yield this.classService.updateCourseScheduleCourse(e.meta.id,t),this.refresh.next(),e.title=this.getEventTitle(t))}))}addCourseSchedule(e){if(!this.selectedStart)this.selectedStart=e.date;else{let a=this.selectedStart<e.date?this.selectedStart:e.date,t=this.selectedStart>e.date?this.selectedStart:e.date,i={start:a,end:t,title:"Yeni Ders",color:{primary:"var(--calendar-primary)",secondary:"var(--calendar-secondary)"},draggable:!0,resizable:{beforeStart:!0,afterEnd:!0},classId:this.selectedClassId||"",teacherId:this.selectedTeacherId||""};this.events=[...this.events,i],this.selectedStart=null,this.refresh.next(),this.modalFormConfig.fields[0].value="",this.modalFormConfig.fields[1].value="",this.modalFormConfig.fields[2].value=a,this.modalFormConfig.fields[3].value=t,this.modalFormConfig.fields[4].value="",this.dialog.open(E,{data:{config:this.modalFormConfig}}).afterClosed().subscribe(r=>f(this,null,function*(){r&&(yield this.classService.createCourseScheduleCourse(v(S({},r),{classId:this.selectedClassId})))}))}}onClassChange(e){let a=this.classService.classes().find(t=>t.id===e);a&&(this.selectedClassId=e,this.classService.getClasSchedule(e),this.classService.selectedClass.update(t=>a)),this.updateEvents()}onTeacherChange(e){this.selectedTeacherId=e,this.updateEvents()}getEventTitle(e){return`<div class="course-name"> ${this.courseService.courses().find(a=>a.id===e.courseId)?.name} </div> <div class="teacher-name"> ${this.teacherService.teachers().find(a=>a.id===e.teacherId)?.name} ${this.teacherService.teachers().find(a=>a.id===e.teacherId)?.surname} </div>
     <div class="time"> ${e.start.getHours().toString().padStart(2,"0")}:${e.start.getMinutes().toString().padStart(2,"0")} - ${e.end.getHours().toString().padStart(2,"0")}:${e.end.getMinutes().toString().padStart(2,"0")} </div>
     <div class="description"> A\xE7\u0131klama: ${e.description||""} </div>`}beforeViewRender(e){setTimeout(()=>{let a=document.querySelector(".cal-time-label-column");if(a){let t=60/this.TIME_PERIOD,i=0;Array.from(a.children).forEach(s=>{Array.from(s.children).forEach(r=>{let g=i*t,u=this.DAY_START_HOUR.getHours()+Math.floor(g/60),M=Math.round(g%60),p=this.viewDate,I=new Date(p);I.setHours(u,M,0,0);let b=(i+1)*t,te=this.DAY_START_HOUR.getHours()+Math.floor(b/60),ae=Math.round(b%60),R=new Date(p);R.setHours(te,ae,0,0),p>=I&&p<R?r.classList.add("current-time-label"):r.classList.remove("current-time-label");let F=r.querySelector(".cal-time");F&&(F.textContent=`${u.toString().padStart(2,"0")}:${M.toString().padStart(2,"0")}`),i++})})}},1e3)}static \u0275fac=function(a){return new(a||l)};static \u0275cmp=O({type:l,selectors:[["app-course-schedule"]],decls:14,vars:15,consts:[[3,"title","subtitle"],["end","",1,"calendar-header"],["appearance","outline"],["placeholder","S\u0131n\u0131f Se\xE7iniz",3,"ngModelChange","selectionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["placeholder","\xD6\u011Fretmen Se\xE7iniz",3,"ngModelChange","selectionChange","ngModel"],[3,"value"],[1,"calendar-container"],[3,"eventTimesChanged","eventClicked","hourSegmentClicked","beforeViewRender","viewDate","events","hourSegments","dayStartHour","dayEndHour","refresh","weekStartsOn","locale"]],template:function(a,t){a&1&&(d(0,"edmin-page-header",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-select",3),y("ngModelChange",function(s){return T(t.selectedClassId,s)||(t.selectedClassId=s),s}),C("selectionChange",function(s){return t.onClassChange(s.value)}),_(4,ie,2,2,"mat-option",4),c()(),d(5,"mat-form-field",2)(6,"mat-label"),h(7,"\xD6\u011Fretmen"),c(),d(8,"mat-select",5),y("ngModelChange",function(s){return T(t.selectedTeacherId,s)||(t.selectedTeacherId=s),s}),C("selectionChange",function(s){return t.onTeacherChange(s.value)}),d(9,"mat-option",6),h(10,"T\xFCm \xD6\u011Fretmenler"),c(),_(11,se,2,2,"mat-option",4),c()()()(),d(12,"div",7)(13,"mwl-calendar-week-view",8),C("eventTimesChanged",function(s){return t.courseScheduleTimesChanged(s)})("eventClicked",function(s){return t.updateCourseSchedule(s.event)})("hourSegmentClicked",function(s){return t.addCourseSchedule(s)})("beforeViewRender",function(s){return t.beforeViewRender(s)}),c()()),a&2&&(o("title","Ders Program\u0131")("subtitle","Ders program\u0131n\u0131 g\xF6r\xFCnt\xFCleyin ve d\xFCzenleyin"),n(3),w("ngModel",t.selectedClassId),n(),o("ngForOf",t.listClass),n(4),w("ngModel",t.selectedTeacherId),n(),o("value",null),n(2),o("ngForOf",t.listTeacher),n(2),o("viewDate",t.viewDate)("events",t.events)("hourSegments",t.TIME_PERIOD)("dayStartHour",t.DAY_START_HOUR.getHours())("dayEndHour",t.DAY_END_HOUR.getHours())("refresh",t.refresh)("weekStartsOn",1)("locale","tr-TR"))},dependencies:[$,A,Z,Q,X,U,Y,P,N,L,W,B,V,x,z,G],styles:["[_nghost-%COMP%]{padding:2rem;max-width:1200px;margin:0 auto;display:block}mwl-calendar-week-view[_ngcontent-%COMP%]{display:block;margin:auto;max-height:calc(100vh - 12rem);overflow:auto;border-radius:8px;border:1px solid var(--border-color)}.calendar-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem}"]})};export{ee as CourseSchedule};
