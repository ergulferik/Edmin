<mat-card class="data-grid-card">
 <mat-card-content>
  <div class="data-grid-actions">
   @if (config.showSearch) {
    <div class="search-container">
     <mat-icon class="search-icon">search</mat-icon>
     <input
      class="search-input"
      type="text"
      [placeholder]="config.searchPlaceholder || 'Ara...'"
      [value]="searchTerm()"
      (input)="onSearchChange($event)"
     />
    </div>
   }

   <ng-content select="[filter]"></ng-content>

   @if (config.showAddButton) {
    <edmin-button [type]="config.addButtonType || 'primary'" (click)="onAddClick()">
     <ng-icon name="heroPlus"></ng-icon>
     {{ config.addButtonText || 'Yeni Ekle' }}
    </edmin-button>
   }
  </div>

  <!-- Error State -->
  @if (error) {
   <div class="data-grid-error">{{ error }}</div>
  }

  <!-- Loading State -->
  @if (loading) {
   <div class="data-grid-loading">
    <mat-spinner diameter="40"></mat-spinner>
   </div>
  }

  <!-- Table -->
  <div class="data-grid-table" [style.maxHeight]="config.maxHeight">
   <table mat-table [dataSource]="filteredData()" class="mat-elevation-z1">
    <!-- Data Columns -->
    <ng-container *ngFor="let column of config.columns" [matColumnDef]="column.key">
     <th mat-header-cell *matHeaderCellDef [style.width]="getColumnWidth(column)">{{ column.label }}</th>
     <td mat-cell *matCellDef="let row" [ngClass]="{ 'image-cell': column.type === 'image' }">
      @switch (column.type) {
       @case ('date') {
        <!-- Tarih alanları için -->
        <span>{{ formatDate(row[column.key]) }}</span>
       }
       @case ('boolean') {
        <!-- Boolean alanları için -->
        <mat-checkbox [checked]="row[column.key]" [disabled]="true" color="primary"> </mat-checkbox>
       }
       @case ('file') {
        <!-- Dosya alanları için -->
        <div class="file-display" [matTooltip]="row[column.key]">
         <ng-icon [name]="getFileIcon(row[column.key])" class="file-icon"></ng-icon>
         <span class="file-name">{{ getFileDisplayName(row[column.key]) }}</span>
        </div>
       }
       @case ('template') {
        <!-- Template alanları için -->
        @if (column.alternative && typeof column.alternative === 'function') {
         <span>{{ column.alternative(row) }}</span>
        } @else {
         <span>{{ getTemplateDisplayValue(row[column.key], column.data, column.keyExpr, column.displayExpr) }}</span>
        }
       }
       @case ('image') {
        <!-- Resim alanları için -->
        <img
         [src]="getImageSrc(row, column)"
         [alt]="row[column.key]"
         class="image-display"
         (error)="onImageError($event, row, column)"
         [style.width]="column.imageOptions?.width"
         [style.height]="column.imageOptions?.height"
         [style.borderRadius]="column.imageOptions?.borderRadius"
         [style.objectFit]="column.imageOptions?.objectFit"
        />
       }
       @case ('avatar') {
        <!-- Avatar alanları için -->
        <edmin-avatar [data]="getAvatarSrc(row, column)" size="36px"></edmin-avatar>
       }
       @default {
        <!-- Varsayılan metin gösterimi -->
        @if (column.alternative && typeof column.alternative === 'function') {
         <span>{{ column.alternative(row) }}</span>
        } @else {
         <span>{{ row[column.key] }}</span>
        }
       }
      }
     </td>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions" *ngIf="actions?.length">
     <th mat-header-cell *matHeaderCellDef [style.width]="'120px'">İşlemler</th>
     <td mat-cell *matCellDef="let element">
      <div class="actions-container">
       <button
        [matTooltip]="action.label || ''"
        *ngFor="let action of actions"
        mat-icon-button
        class="icon-btn"
        (click)="onActionClick(action, element)"
       >
        <ng-icon [class]="action.color" [name]="action.icon || 'heroPencilSquare'"></ng-icon>
       </button>
      </div>
     </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="getDisplayedColumns(); sticky: true"></tr>
    <tr mat-row *matRowDef="let row; columns: getDisplayedColumns()"></tr>
   </table>

   <!-- Empty State -->
   <div *ngIf="!loading && filteredData().length === 0" class="data-grid-empty">Gösterilecek veri bulunamadı.</div>
  </div>
 </mat-card-content>
</mat-card>
